#
# ~/.bashrc
#

# ===============
#    SETTINGS
# ===============

# If not running interactively, don't do anything
[[ $- != *i* ]] && return

set -o emacs # set edit mode
set -o pipefail # fail if any command in pipe fails
shopt -s checkwinsize # check the window size after each command and, if necessary, update the values of LINES and COLUMNS.
shopt -s extglob # enable extended pattern matching features, see http://wiki.bash-hackers.org/syntax/pattern
shopt -s globstar 2>/dev/null # turn on recursive globbing (enables ** to recurse all directories)
shopt -s autocd # a command name that is the name of a directory is executed as if it were the argument to the cd command.
shopt -s direxpand # perform word expansion when trying filename completion useful when trying to type path with variable on it

# minor errors in the spelling of a directory component in a cd command
# will be corrected. The errors checked for are transposed characters,
# a missing character, and one character too many. If a correction is found,
# the corrected file name is printed, and the command proceeds.
shopt -s cdspell 2>/dev/null

# disable Ctrl-S ( flow control )
stty -ixon

# ===============
# HISTORY CONTROL
# ===============

shopt -s histappend # append to the history file, don't overwrite it

# set history length
HISTSIZE=20000
HISTFILESIZE=40000

# don't save duplicates and commands starting with a space
HISTCONTROL=ignorespace:ignoredupes

[[ -z "$FUNCNEST" ]] && export FUNCNEST=100          # limits recursive functions, see 'man bash'

####################################################

# Blesh top init (don't init for the root user)
[[ "$(whoami)" != "root" ]] && source /usr/share/blesh/ble.sh --noattach --rcfile $HOME/.config/blerc

if [ -f ~/.bash_aliases ]; then
    . ~/.bash_aliases
fi

if [ -f ~/.bash_aliases_private ]; then
    . ~/.bash_aliases_private
fi

if [ -f ~/.bash_aliases_work ]; then
    . ~/.bash_aliases_work
fi

bind '"\e[1;5A": history-search-backward'
bind '"\e[1;5B": history-search-forward'

eval "$(oh-my-posh init bash --config ~/.config/oh-my-posh/shell_theme.json)"

source /usr/share/doc/find-the-command/ftc.bash askfirst

gpgconf --launch gpg-agent
export GPG_TTY=$(tty)
export SSH_AUTH_SOCK=$(gpgconf --list-dirs agent-ssh-socket)

# Cache rust builds
export CARGO_INCREMENTAL=1

[[ "$(whoami)" = "root" ]] && return

# Make sure the directory for history exists
mkdir -p "${XDG_STATE_HOME}/bash"

# Python stuff is in there
export PATH=~/.local/bin:$PATH

# Brrrr, file explorer
source ~/.config/broot/launcher/bash/br

# Command hoarder
source /usr/share/doc/hoard/hoard.bash

# Enhanced history
eval "$(atuin init bash --disable-up-arrow)"

# Bruh
export QSYS_ROOTDIR="/home/kloud/QUARTUS/18.1/quartus/sopc_builder/bin"

# Rootless docker
export DOCKER_HOST=unix://$XDG_RUNTIME_DIR/docker.sock

# Attach ble.sh
[[ ${BLE_VERSION-} ]] && ble-attach
